<!DOCTYPE html>
<html>
<head>
<title>借阅信息列表页</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<link href="../../demo/demo.css" rel="stylesheet" type="text/css" />
<script src="../../scripts/boot.js" type="text/javascript"></script>

<style type="text/css">
html, body {
	margin: 0;
	padding: 0;
	border: 0;
	width: 100%;
	height: 100%;
	overflow: hidden;
}
</style>
</head>
<body>
	<h2>借阅信息列表</h2>
	<div>
		<div class="mini-toolbar" style="border-bottom: 0; padding: 0px;">
			<table style="width: 100%;">
				<tr>
					<td style="width: 100%;"><a class="mini-button"
						iconCls="icon-add" onclick="add()">新增借阅</a></td>
				</tr>
			</table>
		</div>
	</div>

	<div class="mini-fit">
		<div id="datagrid" class="mini-datagrid"
			style="width: 100%; height: 100%;"
			url="../../borrowinfolistaction?method=queryborrowinfo" idField="id"
			sortField="returnTime" sortOrder="desc" multiSelect="true">
			<div property="columns">
				<div type="indexcolumn" width="25px" align="center">序</div>
				<div field="borrowId" width="120px" headerAlign="center"
					align="center" allowSort="true">借阅编号</div>
				<!-- <div field="bookId" width="120px" headerAlign="center" align="center" allowSort="true">图书编号</div> -->
				<div field="bookName" width="120px" headerAlign="center"
					align="center" allowSort="true">图书名称</div>
				<div field="borrower" width="120px" headerAlign="center"
					align="center" allowSort="true">借阅人</div>
				<div field="phone" width="100px" headerAlign="center" align="center"
					allowSort="true">联系电话</div>
				<div field="borrowTime" width="120px" headerAlign="center"
					align="center" allowSort="true" >借阅时间</div>
				<div field="returnTime" width="120px" headerAlign="center"
					align="center" allowSort="true" dateFormat="yyyy-MM-dd HH:mm:ss">归还时间</div>
				<div field="optionbutton" width="120px" headerAlign="center"
					align="center" renderer="onOptionButtonRenderer">操作按钮</div>
			</div>
		</div>
	</div>

	<script type="text/javascript">
        mini.parse();

        
        var grid = mini.get("datagrid");
        grid.load();

        
       
        
        /////////////////////////////////////////////////
        
        //新增借阅信息
        function add() {
            mini.open({
                url: bootPATH + "../pages/borrowinfo/borrowinfoadd.html",
                title: "新增借阅", width: 600, height: 400,
                onload: function () {
                },
                ondestroy: function (action) {
                    grid.reload();
                }
            });
        }

        
        //操作按钮渲染
        function onOptionButtonRenderer(e){
        	var borrowId = e.row.borrowId;
        	var returnTime = e.row.returnTime;
        	
        	var str1 = '<a class="mini-button" onclick="deleteBorrowInfo(\'' + borrowId + '\')">删除</a>';
        	var str2 = '<a class="mini-button" onclick="returnBook(\'' + borrowId + '\')">还书</a>';
        	     
        	if(returnTime){
        		return str1;
        	}else{
        		return str2;
        	}
        }
        
        //还书
        function returnBook(borrowId){
        	$.ajax({
        		url: "../../borrowinfolistaction?method=returnbook&borrowid=" + borrowId,
        		type: 'post',
        		cache: false,
        		success: function(text){
        			mini.alert(text);
        			grid.reload();
        		},
        		error: function (jqXHR, textStatus, errorThrown){
        			alert(jqXHR.responseText);
        			CloseWindow();
        		}
        	});
        }

        //删除借阅信息
        function deleteBorrowInfo(borrowId){
                    $.ajax({
                        url: "../../borrowinfolistaction?method=deleteborrowinfo&borrowid=" + borrowId,
                        type: 'post',
                        cache: false,
                        success: function (text) {
                        	mini.alert(text);
                            grid.reload();
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                        	alert(jqXHR.responseText);
                			CloseWindow();
                        }
                    });
                }
                

        //关闭窗口
        function CloseWindow(action) {            
        	if (window.CloseOwnerWindow){
            	return window.CloseOwnerWindow(action);
            }
            else{
            	return window.close();            
            }
        }

    </script>


</body>
</html>